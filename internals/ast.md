# The BCC2 AST

The internal AST is the first intermediate representation generated by the compiler and is built by the parser.  The parser emits an spotty AST with symbols unresolved and with expressions unannotated by types.  

After parsing, a series of semantic analysis passes are made to fill in info on the AST and to find any semantic errors in the source code.  After these passes, the AST should be 100% valid (this is assumed during intermediate code generation).


The BCC2 AST is made up a list of functions.

### Function 

A function represents a single function in the source code with all the information needed to reconstruct the source.

*===========================* 
| name   | FatPtr to source |  
| params | Vector of Param  |
| ret    | Type*            |
| stmts  | Vector of Stmt   | 
*===========================*


### Stmt 

Most of Beans is an expression language, but there are a handful of constructs that are expressed as statements rather than expressions.

Statements are represented as a variant enum with a discriminator called "t" and a SourcePosition representing the start and end in the source code.

#### Kinds 

* STMT_LET - Introduces a name (optionally a value) to the enviroment 

*===================================================*
| name  | SourcePosition of new binding name        |
| type  | Type* (null if inferred, filled in later) |
| value | Expr* (null if not initialized)           |
| var   | ScopeEntry* to symbol table               |
*===================================================*


* STMT_RETURN - Returns from the current function, optionally with a value

*=============================================*
| return | Expr* (null if nothing is returned |
*=============================================*

* STMT_EXPR - A single expression terminated with a ';'

*==============*
| expr | Expr* |
*==============*

### Expr

Expressions are represented as a variant enum with a discriminator called "t" and a SourcePosition representing the start and end in the source code.

#### Kinds

* EXPR_INT - Single integer literal

(uses SourcePosition)

* EXPR_VAR - Reference to an existing variable 

(uses SourcePosition)

* EXPR_BINOP - Binary operation  with two expressions on the left and right

*===============*
| left  | Expr* |
| right | Expr* |
| op    | int   |
*===============*

